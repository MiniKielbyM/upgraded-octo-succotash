!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Descope=t()}(this,(function(){"use strict";const e=(e,t)=>{var n;return["beforeRequest","afterRequest"].reduce(((n,r)=>{var o;return n[r]=[].concat((null===(o=e.hooks)||void 0===o?void 0:o[r])||[]).concat((null==t?void 0:t[r])||[]),n}),null!==(n=e.hooks)&&void 0!==n?n:e.hooks={}),e},t=async e=>{if(!(null==e?void 0:e.ok))return{};const t=await(null==e?void 0:e.clone().json());return(null==t?void 0:t.authInfo)||t||{}},n=async e=>{const n=await t(e);return(null==n?void 0:n.user)||((null==n?void 0:n.hasOwnProperty("userId"))?n:void 0)},r="undefined"!=typeof localStorage,o=(e,t)=>r&&(null===localStorage||void 0===localStorage?void 0:localStorage.setItem(e,t)),i=e=>r&&(null===localStorage||void 0===localStorage?void 0:localStorage.getItem(e)),a=e=>r&&(null===localStorage||void 0===localStorage?void 0:localStorage.removeItem(e));var s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},s.apply(this,arguments)};function u(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function c(e){this.message=e}"function"==typeof SuppressedError&&SuppressedError,c.prototype=new Error,c.prototype.name="InvalidCharacterError";var l="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new c("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,o=0,i=0,a="";r=t.charAt(i++);~r&&(n=o%4?64*n+r:r,o++%4)?a+=String.fromCharCode(255&n>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};function d(e){this.message=e}function p(e,t){if("string"!=typeof e)throw new d("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(l(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return l(t)}}(e.split(".")[n]))}catch(e){throw new d("Invalid token specified: "+e.message)}}d.prototype=new Error,d.prototype.name="InvalidTokenError";var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var g="__lodash_hash_undefined__",v=1/0,y="[object Function]",b="[object GeneratorFunction]",w="[object Symbol]",m=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,I=/^\w*$/,O=/^\./,k=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,j=/\\(\\)?/g,_=/^\[object .+?Constructor\]$/,S="object"==typeof f&&f&&f.Object===Object&&f,U="object"==typeof self&&self&&self.Object===Object&&self,P=S||U||Function("return this")();var R,E=Array.prototype,x=Function.prototype,A=Object.prototype,T=P["__core-js_shared__"],C=(R=/[^.]+$/.exec(T&&T.keys&&T.keys.IE_PROTO||""))?"Symbol(src)_1."+R:"",q=x.toString,D=A.hasOwnProperty,$=A.toString,J=RegExp("^"+q.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),K=P.Symbol,N=E.splice,M=W(P,"Map"),L=W(Object,"create"),F=K?K.prototype:void 0,H=F?F.toString:void 0;function B(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function z(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function V(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function G(e,t){for(var n,r,o=e.length;o--;)if((n=e[o][0])===(r=t)||n!=n&&r!=r)return o;return-1}function Z(e,t){var n;t=function(e,t){if(ne(e))return!1;var n=typeof e;if("number"==n||"symbol"==n||"boolean"==n||null==e||oe(e))return!0;return I.test(e)||!m.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:ne(n=t)?n:X(n);for(var r=0,o=t.length;null!=e&&r<o;)e=e[ee(t[r++])];return r&&r==o?e:void 0}function Y(e){if(!re(e)||(t=e,C&&C in t))return!1;var t,n=function(e){var t=re(e)?$.call(e):"";return t==y||t==b}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?J:_;return n.test(function(e){if(null!=e){try{return q.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}function Q(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function W(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Y(n)?n:void 0}B.prototype.clear=function(){this.__data__=L?L(null):{}},B.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},B.prototype.get=function(e){var t=this.__data__;if(L){var n=t[e];return n===g?void 0:n}return D.call(t,e)?t[e]:void 0},B.prototype.has=function(e){var t=this.__data__;return L?void 0!==t[e]:D.call(t,e)},B.prototype.set=function(e,t){return this.__data__[e]=L&&void 0===t?g:t,this},z.prototype.clear=function(){this.__data__=[]},z.prototype.delete=function(e){var t=this.__data__,n=G(t,e);return!(n<0)&&(n==t.length-1?t.pop():N.call(t,n,1),!0)},z.prototype.get=function(e){var t=this.__data__,n=G(t,e);return n<0?void 0:t[n][1]},z.prototype.has=function(e){return G(this.__data__,e)>-1},z.prototype.set=function(e,t){var n=this.__data__,r=G(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},V.prototype.clear=function(){this.__data__={hash:new B,map:new(M||z),string:new B}},V.prototype.delete=function(e){return Q(this,e).delete(e)},V.prototype.get=function(e){return Q(this,e).get(e)},V.prototype.has=function(e){return Q(this,e).has(e)},V.prototype.set=function(e,t){return Q(this,e).set(e,t),this};var X=te((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(oe(e))return H?H.call(e):"";var t=e+"";return"0"==t&&1/e==-v?"-0":t}(t);var n=[];return O.test(e)&&n.push(""),e.replace(k,(function(e,t,r,o){n.push(r?o.replace(j,"$1"):t||e)})),n}));function ee(e){if("string"==typeof e||oe(e))return e;var t=e+"";return"0"==t&&1/e==-v?"-0":t}function te(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=e.apply(this,r);return n.cache=i.set(o,a),a};return n.cache=new(te.Cache||V),n}te.Cache=V;var ne=Array.isArray;function re(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function oe(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&$.call(e)==w}var ie=h((function(e,t,n){var r=null==e?void 0:Z(e,t);return void 0===r?n:r})),ae="/v1/auth/accesskey/exchange",se="/v1/auth/otp/verify",ue="/v1/auth/otp/signin",ce="/v1/auth/otp/signup",le={email:"/v1/auth/otp/update/email",phone:"/v1/auth/otp/update/phone"},de="/v1/auth/otp/signup-in",pe="/v1/auth/magiclink/verify",fe="/v1/auth/magiclink/signin",he="/v1/auth/magiclink/signup",ge={email:"/v1/auth/magiclink/update/email",phone:"/v1/auth/magiclink/update/phone"},ve="/v1/auth/magiclink/signup-in",ye="/v1/auth/enchantedlink/verify",be="/v1/auth/enchantedlink/signin",we="/v1/auth/enchantedlink/signup",me="/v1/auth/enchantedlink/pending-session",Ie={email:"/v1/auth/enchantedlink/update/email"},Oe="/v1/auth/enchantedlink/signup-in",ke="/v1/auth/oauth/authorize",je="/v1/auth/oauth/exchange",_e="/v1/auth/saml/authorize",Se="/v1/auth/saml/exchange",Ue="/v1/auth/totp/verify",Pe="/v1/auth/totp/signup",Re="/v1/auth/totp/update",Ee={start:"/v1/auth/webauthn/signup/start",finish:"/v1/auth/webauthn/signup/finish"},xe={start:"/v1/auth/webauthn/signin/start",finish:"/v1/auth/webauthn/signin/finish"},Ae={start:"/v1/auth/webauthn/signup-in/start"},Te={start:"v1/auth/webauthn/update/start",finish:"/v1/auth/webauthn/update/finish"},Ce="/v1/auth/password/signup",qe="/v1/auth/password/signin",De="/v1/auth/password/reset",$e="/v1/auth/password/update",Je="/v1/auth/password/replace",Ke="/v1/auth/password/policy",Ne="/v1/auth/refresh",Me="/v1/auth/logout",Le="/v1/auth/logoutall",Fe="/v1/auth/me",He="/v1/flow/start",Be="/v1/flow/next";const ze=6e5,Ve=()=>{const e={};return{headers(t){const n="function"==typeof t.entries?Object.fromEntries(t.entries()):t;return e.Headers=JSON.stringify(n),this},body(t){return e.Body=t,this},url(t){return e.Url=t.toString(),this},method(t){return e.Method=t,this},title(t){return e.Title=t,this},status(t){return e.Status=t,this},build:()=>Object.keys(e).flatMap((t=>e[t]?[`${"Title"!==t?`${t}: `:""}${e[t]}`]:[])).join("\n")}};var Ge;!function(e){e.get="GET",e.delete="DELETE",e.post="POST",e.put="PUT"}(Ge||(Ge={}));const Ze=(...e)=>new Headers(e.reduce(((e,t)=>{const n=(e=>Array.isArray(e)?e:e instanceof Headers?Array.from(e.entries()):e?Object.entries(e):[])(t);return n.reduce(((t,[n,r])=>(e[n]=r,e)),e),e}),{})),Ye=e=>void 0===e?void 0:JSON.stringify(e),Qe=(e,t="")=>{let n=e;return t&&(n=n+":"+t),{Authorization:`Bearer ${n}`}},We=({baseUrl:e,projectId:t,baseConfig:n,logger:r,hooks:o,cookiePolicy:i,fetch:a})=>{const s=((e,t)=>{const n=(e=>async(...t)=>{const n=await e(...t),r=await n.text();return n.text=()=>Promise.resolve(r),n.json=()=>Promise.resolve(JSON.parse(r)),n.clone=()=>n,n})(t||fetch);return n||null==e||e.warn("Fetch is not defined, you will not be able to send http requests, if you are running in a test, make sure fetch is defined globally"),e?async(...t)=>{if(!n)throw Error("Cannot send http request, fetch is not defined, if you are running in a test, make sure fetch is defined globally");e.log((e=>Ve().title("Request").url(e[0]).method(e[1].method).headers(e[1].headers).body(e[1].body).build())(t));const r=await n(...t);return e[r.ok?"log":"error"](await(async e=>{const t=await e.text();return Ve().title("Response").url(e.url.toString()).status(`${e.status} ${e.statusText}`).headers(e.headers).body(t).build()})(r)),r}:n})(r,a),u=async r=>{const a=(null==o?void 0:o.beforeRequest)?o.beforeRequest(r):r,{path:u,body:c,headers:l,queryParams:d,method:p,token:f}=a,h=await s((({path:e,baseUrl:t,queryParams:n})=>{const r=new URL(e,t);return n&&(r.search=new URLSearchParams(n).toString()),r})({path:u,baseUrl:e,queryParams:d}),{headers:Ze(Qe(t,f),{"x-descope-sdk-name":"core-js","x-descope-sdk-version":"1.7.3"},(null==n?void 0:n.baseHeaders)||{},l),method:p,body:Ye(c),credentials:i||"include"});return(null==o?void 0:o.afterRequest)&&await o.afterRequest(r,null==h?void 0:h.clone()),h};return{get:(e,{headers:t,queryParams:n,token:r}={})=>u({path:e,headers:t,queryParams:n,body:void 0,method:Ge.get,token:r}),post:(e,t,{headers:n,queryParams:r,token:o}={})=>u({path:e,headers:n,queryParams:r,body:t,method:Ge.post,token:o}),put:(e,t,{headers:n,queryParams:r,token:o}={})=>u({path:e,headers:n,queryParams:r,body:t,method:Ge.put,token:o}),delete:(e,{headers:t,queryParams:n,token:r}={})=>u({path:e,headers:t,queryParams:n,body:void 0,method:Ge.delete,token:r}),hooks:o}};var Xe=429;function et(e,t,n){var r;let o=tt(e);t&&(o=null===(r=null==o?void 0:o.tenants)||void 0===r?void 0:r[t]);const i=null==o?void 0:o[n];return Array.isArray(i)?i:[]}function tt(e){if("string"!=typeof e||!e)throw new Error("Invalid token provided");return p(e)}function nt(e){const{exp:t}=tt(e);return(new Date).getTime()/1e3>t}function rt(e){let t=tt(e);const n=Object.keys(null==t?void 0:t.tenants);return Array.isArray(n)?n:[]}function ot(e,t){return et(e,t,"permissions")}function it(e,t){return et(e,t,"roles")}const at=(...e)=>e.join("/").replace(/\/{2,}/g,"/");async function st(e,t){var n;const r=await e,o={code:r.status,ok:r.ok,response:r},i=await r.clone().json();return r.ok?o.data=t?t(i):i:(o.error=i,r.status===Xe&&Object.assign(o.error,{retryAfter:Number.parseInt(null===(n=r.headers)||void 0===n?void 0:n.get("retry-after"))||0})),o}const ut=(e,t)=>(n=t)=>t=>!e(t)&&n.replace("{val}",t),ct=(...e)=>({validate:t=>(e.forEach((e=>{const n=e(t);if(n)throw new Error(n)})),!0)}),lt=e=>t=>e.test(t),dt=lt(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/),pt=lt(/^\+[1-9]{1}[0-9]{3,14}$/),ft=ut(dt,'"{val}" is not a valid email'),ht=ut(pt,'"{val}" is not a valid phone number'),gt=ut((1,e=>e.length>=1),"Minimum length is 1");const vt=ut((e=>"string"==typeof e),"Input is not a string"),yt=ut((e=>void 0===e),"Input is defined"),bt=(wt=[vt(),yt()],"Input is not a string or undefined",(e="Input is not a string or undefined")=>t=>{const n=wt.filter((e=>e(t)));return!(n.length<wt.length)&&(e?e.replace("{val}",t):n.join(" OR "))});var wt;const mt=(...e)=>t=>(...n)=>(e.forEach(((e,t)=>ct(...e).validate(n[t]))),t(...n)),It=e=>[vt(`"${e}" must be a string`),gt(`"${e}" must not be empty`)],Ot=e=>[vt(`"${e}" must be a string`),ft()],kt=e=>[vt(`"${e}" must be a string`),ht()],jt=mt(It("accessKey")),_t=e=>({exchange:jt((t=>st(e.post(ae,{},{token:t}))))});var St,Ut;!function(e){e.sms="sms",e.whatsapp="whatsapp"}(St||(St={})),function(e){e.email="email"}(Ut||(Ut={}));const Pt=Object.assign(Object.assign({},St),Ut);var Rt;!function(e){e.waiting="waiting",e.running="running",e.completed="completed",e.failed="failed"}(Rt||(Rt={}));const Et=It("loginId"),xt=mt(It("token")),At=mt(Et),Tt=mt(It("pendingRef")),Ct=mt(Et,Ot("email")),qt=e=>({verify:xt((t=>st(e.post(ye,{token:t})))),signIn:At(((t,n,r,o)=>st(e.post(at(be,Pt.email),{loginId:t,URI:n,loginOptions:r},{token:o})))),signUpOrIn:At(((t,n)=>st(e.post(at(Oe,Pt.email),{loginId:t,URI:n})))),signUp:At(((t,n,r)=>st(e.post(at(we,Pt.email),{loginId:t,URI:n,user:r})))),waitForSession:Tt(((t,n)=>new Promise((r=>{const{pollingIntervalMs:o,timeoutMs:i}=(({pollingIntervalMs:e=1e3,timeoutMs:t=6e5}={})=>({pollingIntervalMs:Math.max(e||1e3,1e3),timeoutMs:Math.min(t||ze,ze)}))(n);let a;const s=setInterval((async()=>{const n=await e.post(me,{pendingRef:t});n.ok&&(clearInterval(s),a&&clearTimeout(a),r(st(Promise.resolve(n))))}),o);a=setTimeout((()=>{r({error:{errorDescription:`Session polling timeout exceeded: ${i}ms`,errorCode:"0"},ok:!1}),clearInterval(s)}),i)})))),update:{email:Ct(((t,n,r,o,i)=>st(e.post(Ie.email,Object.assign({loginId:t,email:n,URI:r},i),{token:o}))))}}),Dt=mt(It("flowId")),$t=mt(It("executionId"),It("stepId"),It("interactionId")),Jt=e=>({start:Dt(((t,n,r,o,i,a)=>st(e.post(He,{flowId:t,options:n,conditionInteractionId:r,interactionId:o,input:i,version:a})))),next:$t(((t,n,r,o,i)=>st(e.post(Be,{executionId:t,stepId:n,interactionId:r,input:o,version:i}))))}),Kt=It("loginId"),Nt=mt(It("token")),Mt=mt(Kt),Lt=mt(Kt,kt("phone")),Ft=mt(Kt,Ot("email")),Ht=e=>({verify:Nt((t=>st(e.post(pe,{token:t})))),signIn:Object.keys(Pt).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Mt(((t,r,o,i)=>st(e.post(at(fe,n),{loginId:t,URI:r,loginOptions:o},{token:i}))))})),{}),signUp:Object.keys(Pt).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Mt(((t,r,o)=>st(e.post(at(he,n),{loginId:t,URI:r,user:o}))))})),{}),signUpOrIn:Object.keys(Pt).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Mt(((t,r)=>st(e.post(at(ve,n),{loginId:t,URI:r}))))})),{}),update:{email:Ft(((t,n,r,o,i)=>st(e.post(ge.email,Object.assign({loginId:t,email:n,URI:r},i),{token:o})))),phone:Object.keys(St).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Lt(((t,r,o,i,a)=>st(e.post(at(ge.phone,n),Object.assign({loginId:t,phone:r,URI:o},a),{token:i}))))})),{})}});var Bt;!function(e){e.facebook="facebook",e.github="github",e.google="google",e.microsoft="microsoft",e.gitlab="gitlab",e.apple="apple",e.discord="discord",e.linkedin="linkedin"}(Bt||(Bt={}));const zt=mt(It("code")),Vt=e=>({start:Object.keys(Bt).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:(t,r,o)=>st(e.post(ke,r||{},{queryParams:Object.assign({provider:n},t&&{redirectURL:t}),token:o}))})),{}),exchange:zt((t=>st(e.post(je,{code:t}))))}),Gt=It("loginId"),Zt=mt(Gt,It("code")),Yt=mt(Gt),Qt=mt(Gt,kt("phone")),Wt=mt(Gt,Ot("email")),Xt=e=>({verify:Object.keys(Pt).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Zt(((t,r)=>st(e.post(at(se,n),{code:r,loginId:t}))))})),{}),signIn:Object.keys(Pt).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Yt(((t,r,o)=>st(e.post(at(ue,n),{loginId:t,loginOptions:r},{token:o}))))})),{}),signUp:Object.keys(Pt).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Yt(((t,r)=>st(e.post(at(ce,n),{loginId:t,user:r}))))})),{}),signUpOrIn:Object.keys(Pt).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Yt((t=>st(e.post(at(de,n),{loginId:t}))))})),{}),update:{email:Wt(((t,n,r,o)=>st(e.post(le.email,Object.assign({loginId:t,email:n},o),{token:r})))),phone:Object.keys(St).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Qt(((t,r,o,i)=>st(e.post(at(le.phone,n),Object.assign({loginId:t,phone:r},i),{token:o}))))})),{})}}),en=mt(It("tenant")),tn=mt(It("code")),nn=e=>({start:en(((t,n,r,o)=>st(e.post(_e,r||{},{queryParams:{tenant:t,redirectURL:n},token:o})))),exchange:tn((t=>st(e.post(Se,{code:t}))))}),rn=It("loginId"),on=mt(rn,It("code")),an=mt(rn),sn=mt(rn),un=e=>({signUp:an(((t,n)=>st(e.post(Pe,{loginId:t,user:n})))),verify:on(((t,n,r,o)=>st(e.post(Ue,{loginId:t,code:n,loginOptions:r},{token:o})))),update:sn(((t,n)=>st(e.post(Re,{loginId:t},{token:n}))))}),cn=It("loginId"),ln=It("newPassword"),dn=mt(cn,It("password")),pn=mt(cn),fn=mt(cn,ln),hn=mt(cn,It("oldPassword"),ln),gn=e=>({signUp:dn(((t,n,r)=>st(e.post(Ce,{loginId:t,password:n,user:r})))),signIn:dn(((t,n)=>st(e.post(qe,{loginId:t,password:n})))),sendReset:pn(((t,n)=>st(e.post(De,{loginId:t,redirectUrl:n})))),update:fn(((t,n,r)=>st(e.post($e,{loginId:t,newPassword:n},{token:r})))),replace:hn(((t,n,r)=>st(e.post(Je,{loginId:t,oldPassword:n,newPassword:r})))),policy:()=>st(e.get(Ke))}),vn=[vt('"loginId" must be a string')],yn=It("loginId"),bn=It("origin"),wn=mt(yn,bn,It("name")),mn=mt(yn,bn),In=mt(vn,bn),On=mt(yn,bn,It("token")),kn=mt(It("transactionId"),It("response")),jn=e=>({signUp:{start:wn(((t,n,r)=>st(e.post(Ee.start,{user:{loginId:t,name:r},origin:n})))),finish:kn(((t,n)=>st(e.post(Ee.finish,{transactionId:t,response:n}))))},signIn:{start:In(((t,n,r,o)=>st(e.post(xe.start,{loginId:t,origin:n,loginOptions:r},{token:o})))),finish:kn(((t,n)=>st(e.post(xe.finish,{transactionId:t,response:n}))))},signUpOrIn:{start:mn(((t,n)=>st(e.post(Ae.start,{loginId:t,origin:n}))))},update:{start:On(((t,n,r)=>st(e.post(Te.start,{loginId:t,origin:n},{token:r})))),finish:kn(((t,n)=>st(e.post(Te.finish,{transactionId:t,response:n}))))}}),_n=mt(It("token")),Sn=mt([bt('"token" must be string or undefined')]);var Un,Pn=mt([("projectId",Un=It("projectId"),ut(((e,t)=>n=>ct(...t).validate(ie(n,e)))("projectId",Un))())])((e=>{var t,n;const r=[].concat((null===(t=e.hooks)||void 0===t?void 0:t.beforeRequest)||[]),o=[].concat((null===(n=e.hooks)||void 0===n?void 0:n.afterRequest)||[]);return(({projectId:e,logger:t,baseUrl:n,hooks:r,cookiePolicy:o,baseHeaders:i={},fetch:a})=>{return s=We({baseUrl:n||"https://api.descope.com",projectId:e,logger:t,hooks:r,cookiePolicy:o,baseConfig:{baseHeaders:i},fetch:a}),{accessKey:_t(s),otp:Xt(s),magicLink:Ht(s),enchantedLink:qt(s),oauth:Vt(s),saml:nn(s),totp:un(s),webauthn:jn(s),password:gn(s),flow:Jt(s),refresh:Sn((e=>st(s.post(Ne,{},{token:e})))),logout:Sn((e=>st(s.post(Me,{},{token:e})))),logoutAll:Sn((e=>st(s.post(Le,{},{token:e})))),me:Sn((e=>st(s.get(Fe,{token:e})))),isJwtExpired:_n(nt),getTenants:_n(rt),getJwtPermissions:_n(ot),getJwtRoles:_n(it),httpClient:s};var s})(Object.assign(Object.assign({},e),{hooks:{beforeRequest:e=>null==r?void 0:r.reduce(((e,t)=>t(e)),e),afterRequest:async(t,n)=>{(await Promise.allSettled(null==o?void 0:o.map((e=>e(t,null==n?void 0:n.clone()))))).forEach((t=>{var n;return"rejected"===t.status&&(null===(n=e.logger)||void 0===n?void 0:n.error(t.reason))}))}}}))}));const Rn=(e,t,n)=>(t.forEach((t=>{const r=t.split(".");let o=r.shift(),i=e;for(;r.length>0;){if(i=i[o],!o||!i)throw Error(`Invalid path "${t}", "${o}" is missing or has no value`);o=r.shift()}if("function"!=typeof i[o])throw Error(`"${t}" is not a function`);const a=i[o];i[o]=n(a)})),e);var En=Object.assign(Pn,{DeliveryMethods:Pt});const xn=(...e)=>{console.debug(...e)},An="undefined"!=typeof window,Tn=An&&(null===localStorage||void 0===localStorage?void 0:localStorage.getItem("fingerprint.endpoint.url"))||"https://fp.descope.com";var Cn="Blocked by CSP",qn="9319";function Dn(e,t){var n=[];return function(e,t){var n,r,o=(r=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],e,!0),{current:function(){return r[0]},postpone:function(){var e=r.shift();void 0!==e&&r.push(e)},exclude:function(){r.shift()}}),i=(100,3e3,n=0,function(){return Math.random()*Math.min(3e3,100*Math.pow(2,n++))}),a=o.current();if(void 0===a)return Promise.reject(new TypeError("The list of script URL patterns is empty"));var s=function(e,n){return t(e).catch((function(e){if(n+1>=5)throw e;!function(e){if(!(e instanceof Error))return!1;var t=e.message;return t===Cn||t===qn}(e)?o.postpone():o.exclude();var t,r=o.current();if(void 0===r)throw e;return(t=i(),new Promise((function(e){return setTimeout(e,t)}))).then((function(){return s(r,n+1)}))}))};return s(a,0)}(e,(function(e){var r=new Date,o=function(t){return n.push({url:e,startedAt:r,finishedAt:new Date,error:t})},i=t(e);return i.then((function(){return o()}),o),i})).then((function(e){return[e,{attempts:n}]}))}var $n="Failed to load the JS script of the agent";function Jn(e){var t;e.scriptUrlPattern;var n=e.token,r=e.apiKey,o=void 0===r?n:r,i=u(e,["scriptUrlPattern","token","apiKey"]),a=null!==(t=function(e,t){return function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(e,t)?e[t]:void 0}(e,"scriptUrlPattern"))&&void 0!==t?t:"https://fpnpmcdn.net/v<version>/<apiKey>/loader_v<loaderVersion>.js";return Promise.resolve().then((function(){if(!o||"string"!=typeof o)throw new Error("API key required");var e=function(e,t){return(Array.isArray(e)?e:[e]).map((function(e){return function(e,t){var n=encodeURIComponent;return e.replace(/<[^<>]+>/g,(function(e){return"<version>"===e?"3":"<apiKey>"===e?n(t):"<loaderVersion>"===e?n("3.8.5"):e}))}(String(e),t)}))}(a,o);return Dn(e,Kn).catch(Mn)})).then((function(e){var t=e[0],n=e[1];return t.load(s(s({},i),{ldi:n}))}))}function Kn(e){return function(e,t,n,r){var o,i=document,a="securitypolicyviolation",s=function(t){var n=new URL(e,location.href),r=t.blockedURI;r!==n.href&&r!==n.protocol.slice(0,-1)&&r!==n.origin||(o=t,u())};i.addEventListener(a,s);var u=function(){return i.removeEventListener(a,s)};return Promise.resolve().then(t).then((function(e){return u(),e}),(function(e){return new Promise((function(e){return setTimeout(e)})).then((function(){if(u(),o)return function(){throw new Error(Cn)}();throw e}))}))}(e,(function(){return function(e){return new Promise((function(t,n){var r=document.createElement("script"),o=function(){var e;return null===(e=r.parentNode)||void 0===e?void 0:e.removeChild(r)},i=document.head||document.getElementsByTagName("head")[0];r.onload=function(){o(),t()},r.onerror=function(){o(),n(new Error($n))},r.async=!0,r.src=e,i.appendChild(r)}))}(e)})).then(Nn)}function Nn(){var e=window,t="__fpjs_p_l_b",n=e[t];if(function(e,t){var n,r=null===(n=Object.getOwnPropertyDescriptor)||void 0===n?void 0:n.call(Object,e,t);(null==r?void 0:r.configurable)?delete e[t]:r&&!r.writable||(e[t]=void 0)}(e,t),"function"!=typeof(null==n?void 0:n.load))throw new Error(qn);return n}function Mn(e){throw e instanceof Error&&e.message===qn?new Error($n):e}const Ln=(e="",t="")=>({vsid:e,vrid:t}),Fn=(e=!1)=>{const t=localStorage.getItem("fp");if(!t)return null;const n=JSON.parse(t);return(new Date).getTime()>n.expiry&&!e?null:n.value},Hn=async e=>{try{if(Fn())return;const t=(Date.now().toString(36)+Math.random().toString(36).substring(2)+Math.random().toString(36).substring(2)).substring(0,27),n=Jn({apiKey:e,endpoint:Tn}),r=await n,{requestId:o}=await r.get({linkedId:t});(e=>{const t={value:e,expiry:(new Date).getTime()+864e5};localStorage.setItem("fp",JSON.stringify(t))})(Ln(t,o))}catch(e){global.FB_DEBUG&&console.error(e)}},Bn=e=>(e.body&&(e.body.fpData=Fn(!0)||Ln()),e),zn="dls_last_user_login_id",Vn="dls_last_user_display_name",Gn=()=>i(zn),Zn=()=>i(Vn),Yn=e=>async(...t)=>{var n;t[1]=t[1]||{};const[,r={}]=t,o=Gn(),i=Zn();o&&(null!==(n=r.lastAuth)&&void 0!==n||(r.lastAuth={}),r.lastAuth.loginId=o,r.lastAuth.name=i);return await e(...t)},Qn=e=>async(...t)=>{const n=await e(...t);return a(zn),a(Vn),n};function Wn(){const e=[];return{pub:t=>{e.forEach((e=>e(t)))},sub:t=>{const n=e.push(t)-1;return()=>e.splice(n,1)}}}
/*! js-cookie v3.0.5 | MIT */
function Xn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}var er=function e(t,n){function r(e,r,o){if("undefined"!=typeof document){"number"==typeof(o=Xn({},n,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var a in o)o[a]&&(i+="; "+a,!0!==o[a]&&(i+="="+o[a].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+i}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},o=0;o<n.length;o++){var i=n[o].split("="),a=i.slice(1).join("=");try{var s=decodeURIComponent(i[0]);if(r[s]=t.read(a,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",Xn({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,Xn({},this.attributes,t))},withConverter:function(t){return e(Xn({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const tr="DS",nr="DSR";const rr=(e={},t)=>{var{refreshJwt:n,sessionJwt:r}=e,i=u(e,["refreshJwt","sessionJwt"]);void 0===t&&(t=!1),n&&o(nr,n),r&&(t?function(e,t,{cookiePath:n,cookieDomain:r,cookieExpiration:o}){if(t){const i=new Date(1e3*o);er.set(e,t,{path:n,domain:r,expires:i,sameSite:"Strict",secure:!0})}}(tr,r,i):o(tr,r))};function or(){return i(nr)||""}function ir(){return er.get(tr)||i(tr)||""}function ar(){a(nr),a(tr),er.remove(tr)}const sr=e=>Object.assign(e,{token:e.token||or()}),ur=e=>async(...t)=>{const n=await e(...t);return ar(),n};async function cr(e){const t=function(e){var t;const n=JSON.parse(e);return n.publicKey.challenge=gr(n.publicKey.challenge),n.publicKey.user.id=gr(n.publicKey.user.id),null===(t=n.publicKey.excludeCredentials)||void 0===t||t.forEach((e=>{e.id=gr(e.id)})),n}(e),n=await navigator.credentials.create(t);return r=n,JSON.stringify({id:r.id,rawId:vr(r.rawId),type:r.type,response:{attestationObject:vr(r.response.attestationObject),clientDataJSON:vr(r.response.clientDataJSON)}});var r}async function lr(e){const t=fr(e);return hr(await navigator.credentials.get(t))}async function dr(e,t){const n=fr(e);n.signal=t.signal,n.mediation="conditional";return hr(await navigator.credentials.get(n))}async function pr(e=!1){if(!An)return Promise.resolve(!1);const t=!!(window.PublicKeyCredential&&navigator.credentials&&navigator.credentials.create&&navigator.credentials.get);return t&&e&&PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():t}function fr(e){var t;const n=JSON.parse(e);return n.publicKey.challenge=gr(n.publicKey.challenge),null===(t=n.publicKey.allowCredentials)||void 0===t||t.forEach((e=>{e.id=gr(e.id)})),n}function hr(e){return JSON.stringify({id:e.id,rawId:vr(e.rawId),type:e.type,response:{authenticatorData:vr(e.response.authenticatorData),clientDataJSON:vr(e.response.clientDataJSON),signature:vr(e.response.signature),userHandle:e.response.userHandle?vr(e.response.userHandle):void 0}})}function gr(e){const t=e.replace(/_/g,"/").replace(/-/g,"+");return Uint8Array.from(atob(t),(e=>e.charCodeAt(0))).buffer}function vr(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}var yr,br=(yr=e=>({async signUp(t,n){const r=await e.webauthn.signUp.start(t,window.location.origin,n);if(!r.ok)return r;const o=await cr(r.data.options);return await e.webauthn.signUp.finish(r.data.transactionId,o)},async signIn(t){const n=await e.webauthn.signIn.start(t,window.location.origin);if(!n.ok)return n;const r=await lr(n.data.options);return await e.webauthn.signIn.finish(n.data.transactionId,r)},async signUpOrIn(t){var n;const r=await e.webauthn.signUpOrIn.start(t,window.location.origin);if(!r.ok)return r;if(null===(n=r.data)||void 0===n?void 0:n.create){const t=await cr(r.data.options);return await e.webauthn.signUp.finish(r.data.transactionId,t)}{const t=await lr(r.data.options);return await e.webauthn.signIn.finish(r.data.transactionId,t)}},async update(t,n){const r=await e.webauthn.update.start(t,window.location.origin,n);if(!r.ok)return r;const o=await cr(r.data.options);return await e.webauthn.update.finish(r.data.transactionId,o)},helpers:{create:cr,get:lr,isSupported:pr,conditional:dr}}),(...e)=>{const t=yr(...e);return Object.assign(t.signUp,e[0].webauthn.signUp),Object.assign(t.signIn,e[0].webauthn.signIn),Object.assign(t.signUpOrIn,e[0].webauthn.signUpOrIn),Object.assign(t.update,e[0].webauthn.update),t}),wr=e=>Object.assign(Object.assign({},e.flow),{start:async(...t)=>{const n=await pr(),r=Object.assign(Object.assign({redirectUrl:window.location.href,location:window.location.href},t[1]),{deviceInfo:{webAuthnSupport:n}});return t[1]=r,e.flow.start(...t)}});const mr=function(...e){return t=>e.reduce(((e,t)=>t(e)),t)}((t=>n=>{var{fpKey:r,fpLoad:o}=n,i=u(n,["fpKey","fpLoad"]);return r?(An?o&&Hn(r).catch((()=>null)):console.warn("Fingerprint is a client side only capability and will not work when running in the server"),t(e(i,{beforeRequest:Bn}))):t(Object.assign({},i))}),(n=>r=>{var{autoRefresh:o}=r,i=u(r,["autoRefresh"]);if(!o)return n(i);const{clearAllTimers:a,setTimer:s}=(()=>{const e=[];return{clearAllTimers:()=>{for(;e.length;)clearTimeout(e.pop())},setTimer:(t,n)=>{e.push(setTimeout(t,n))}}})();let c,l;document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&new Date>c&&(xn("Expiration time passed, refreshing session"),d.refresh(l))}));const d=n(e(i,{afterRequest:async(e,n)=>{const{refreshJwt:r,sessionJwt:o}=await t(n);if(401===(null==n?void 0:n.status))xn("Received 401, canceling all timers"),a();else if(o){c=(e=>{const t=e.split(".");try{if(3===t.length){const e=JSON.parse(window.atob(t[1]));if(e.exp)return new Date(1e3*e.exp)}}catch(e){}return null})(o),l=r;const e=((i=c)?i.getTime()-(new Date).getTime():0)-2e4;a();const t=new Date(Date.now()+e).toLocaleTimeString("en-US",{hour12:!1});xn(`Setting refresh timer for ${t}. (${e}ms)`),s((()=>{xn("Refreshing session due to timer"),d.refresh(r)}),e)}var i}}));return Rn(d,["logout","logoutAll"],(e=>async(...t)=>{const n=await e(...t);return xn("Clearing all timers"),a(),n}))}),(e=>t=>e(Object.assign(Object.assign({},t),{baseHeaders:Object.assign({"x-descope-sdk-name":"web-js","x-descope-sdk-version":"1.4.3"},t.baseHeaders)}))),(r=>o=>{const i=Wn(),a=Wn(),s=r(e(o,{afterRequest:async(e,r)=>{if(401===(null==r?void 0:r.status))i.pub(null),a.pub(null);else{const e=await n(r);e&&a.pub(e);const{sessionJwt:o}=await t(r);o&&i.pub(o)}}})),u=Rn(s,["logout","logoutAll"],(e=>async(...t)=>{const n=await e(...t);return i.pub(null),a.pub(null),n}));return Object.assign(u,{onSessionTokenChange:i.sub,onUserChange:a.sub})}),(t=>r=>{const i=t(e(r,{afterRequest:async(e,t)=>{var r;const i=await n(t),a=null===(r=null==i?void 0:i.loginIds)||void 0===r?void 0:r[0],s=null==i?void 0:i.name;a&&((e=>{o(zn,e)})(a),(e=>{o(Vn,e)})(s))}}));let a=Rn(i,["flow.start"],Yn);return a=Rn(a,["logout","logoutAll"],Qn),Object.assign(a,{getLastUserLoginId:Gn,getLastUserDisplayName:Zn})}),(n=>r=>{var{persistTokens:o,sessionTokenViaCookie:i}=r,a=u(r,["persistTokens","sessionTokenViaCookie"]);if(!o||!An)return o&&console.warn("Storing auth tokens in local storage and cookies are a client side only capabilities and will not be done when running in the server"),n(a);const s=n(e(a,{beforeRequest:sr,afterRequest:async(e,n)=>{401===(null==n?void 0:n.status)?ar():rr(await t(n),i)}})),c=Rn(s,["logout","logoutAll"],ur);return Object.assign(c,{getRefreshToken:or,getSessionToken:ir})}))(((...e)=>{const t=En(...e);return Object.assign(Object.assign({},t),{flow:wr(t),webauthn:br(t)})}));return mr.REFRESH_TOKEN_KEY=nr,mr.SESSION_TOKEN_KEY=tr,mr}));
//# sourceMappingURL=index.umd.js.map
